<?xml version="1.0" encoding="UTF-8"?>
<svg width="1400" height="1000" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font-family: Arial, sans-serif; font-size: 24px; font-weight: bold; fill: #2c3e50; }
      .layer-title { font-family: Arial, sans-serif; font-size: 16px; font-weight: bold; fill: #34495e; }
      .component-title { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; fill: #2c3e50; }
      .text { font-family: Arial, sans-serif; font-size: 12px; fill: #2c3e50; }
      .small-text { font-family: Arial, sans-serif; font-size: 10px; fill: #7f8c8d; }
      
      .data-layer { fill: #e8f5e8; stroke: #27ae60; stroke-width: 2; }
      .processing-layer { fill: #e8f4f8; stroke: #3498db; stroke-width: 2; }
      .storage-layer { fill: #fff9e6; stroke: #f39c12; stroke-width: 2; }
      .api-layer { fill: #fdf2e9; stroke: #e67e22; stroke-width: 2; }
      .integration-layer { fill: #f3e5f5; stroke: #9b59b6; stroke-width: 2; }
      
      .component { fill: #ffffff; stroke: #34495e; stroke-width: 1.5; rx: 6; }
      .config-component { fill: #f8f9fa; stroke: #6c757d; stroke-width: 1; rx: 4; }
      
      .arrow { stroke: #34495e; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .data-flow { stroke: #27ae60; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .api-flow { stroke: #e67e22; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#34495e" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="700" y="30" text-anchor="middle" class="title">KMS-SFDC Technical Architecture</text>
  <text x="700" y="50" text-anchor="middle" class="small-text">Production-Scale FAISS Vector Database for Semantic Case Search</text>
  
  <!-- Data Source Layer -->
  <rect x="50" y="80" width="1300" height="120" class="data-layer" rx="8"/>
  <text x="70" y="105" class="layer-title">Data Source Layer</text>
  
  <rect x="100" y="120" width="200" height="70" class="component"/>
  <text x="200" y="140" text-anchor="middle" class="component-title">Salesforce Org</text>
  <text x="120" y="160" class="text">• 2.5M+ Case records</text>
  <text x="120" y="175" class="text">• Real-time API access</text>
  
  <rect x="350" y="120" width="200" height="70" class="component"/>
  <text x="450" y="140" text-anchor="middle" class="component-title">SFDC Client</text>
  <text x="370" y="160" class="text">• simple-salesforce library</text>
  <text x="370" y="175" class="text">• Batch extraction (2K/batch)</text>
  
  <rect x="600" y="120" width="250" height="70" class="component"/>
  <text x="725" y="140" text-anchor="middle" class="component-title">Field Mapping</text>
  <text x="620" y="160" class="text">• Config → SFDC field mapping</text>
  <text x="620" y="175" class="text">• 8 text fields per case</text>
  
  <rect x="900" y="120" width="200" height="70" class="config-component"/>
  <text x="1000" y="140" text-anchor="middle" class="component-title">Authentication</text>
  <text x="920" y="160" class="text">• Username/Password/Token</text>
  <text x="920" y="175" class="text">• Environment variables</text>
  
  <!-- Data Processing Layer -->
  <rect x="50" y="230" width="1300" height="140" class="processing-layer" rx="8"/>
  <text x="70" y="255" class="layer-title">Data Processing Layer</text>
  
  <rect x="100" y="275" width="180" height="80" class="component"/>
  <text x="190" y="295" text-anchor="middle" class="component-title">Text Processor</text>
  <text x="120" y="315" class="text">• HTML/URL removal</text>
  <text x="120" y="330" class="text">• Text normalization</text>
  <text x="120" y="345" class="text">• Field combination</text>
  
  <rect x="320" y="275" width="180" height="80" class="component"/>
  <text x="410" y="295" text-anchor="middle" class="component-title">Embedding Model</text>
  <text x="340" y="315" class="text">• SentenceTransformers (384-dim)</text>
  <text x="340" y="330" class="text">• SentenceTransformer</text>
  <text x="340" y="345" class="text">• trust_remote_code=True</text>
  
  <rect x="540" y="275" width="180" height="80" class="component"/>
  <text x="630" y="295" text-anchor="middle" class="component-title">Batch Processing</text>
  <text x="560" y="315" class="text">• 5K embedding batches</text>
  <text x="560" y="330" class="text">• 50K indexing batches</text>
  <text x="560" y="345" class="text">• Memory optimization</text>
  
  <rect x="760" y="275" width="180" height="80" class="component"/>
  <text x="850" y="295" text-anchor="middle" class="component-title">Vector Normalization</text>
  <text x="780" y="315" class="text">• L2 normalization</text>
  <text x="780" y="330" class="text">• FAISS optimization</text>
  <text x="780" y="345" class="text">• Cosine similarity</text>
  
  <rect x="980" y="275" width="180" height="80" class="component"/>
  <text x="1070" y="295" text-anchor="middle" class="component-title">Quality Control</text>
  <text x="1000" y="315" class="text">• Text length filtering</text>
  <text x="1000" y="330" class="text">• Duplicate detection</text>
  <text x="1000" y="345" class="text">• Data validation</text>
  
  <!-- Storage Layer -->
  <rect x="50" y="400" width="1300" height="140" class="storage-layer" rx="8"/>
  <text x="70" y="425" class="layer-title">Vector Storage Layer</text>
  
  <rect x="100" y="445" width="200" height="80" class="component"/>
  <text x="200" y="465" text-anchor="middle" class="component-title">FAISS Index</text>
  <text x="120" y="485" class="text">• IndexIVFPQ type</text>
  <text x="120" y="500" class="text">• 4096 clusters (nlist)</text>
  <text x="120" y="515" class="text">• 64 subquantizers (m)</text>
  
  <rect x="340" y="445" width="200" height="80" class="component"/>
  <text x="440" y="465" text-anchor="middle" class="component-title">Metadata Store</text>
  <text x="360" y="485" class="text">• Case metadata JSON</text>
  <text x="360" y="500" class="text">• Integer key mapping</text>
  <text x="360" y="515" class="text">• Search result enrichment</text>
  
  <rect x="580" y="445" width="200" height="80" class="component"/>
  <text x="680" y="465" text-anchor="middle" class="component-title">File System</text>
  <text x="600" y="485" class="text">• Binary index files</text>
  <text x="600" y="500" class="text">• Memory mapping</text>
  <text x="600" y="515" class="text">• Backup/versioning</text>
  
  <rect x="820" y="445" width="200" height="80" class="component"/>
  <text x="920" y="465" text-anchor="middle" class="component-title">Index Management</text>
  <text x="840" y="485" class="text">• Incremental updates</text>
  <text x="840" y="500" class="text">• Health monitoring</text>
  <text x="840" y="515" class="text">• Performance metrics</text>
  
  <rect x="1060" y="445" width="200" height="80" class="component"/>
  <text x="1160" y="465" text-anchor="middle" class="component-title">Configuration</text>
  <text x="1080" y="485" class="text">• YAML config files</text>
  <text x="1080" y="500" class="text">• Environment variables</text>
  <text x="1080" y="515" class="text">• Pydantic validation</text>
  
  <!-- API Layer -->
  <rect x="50" y="570" width="1300" height="140" class="api-layer" rx="8"/>
  <text x="70" y="595" class="layer-title">API Service Layer</text>
  
  <rect x="100" y="615" width="180" height="80" class="component"/>
  <text x="190" y="635" text-anchor="middle" class="component-title">FastAPI Server</text>
  <text x="120" y="655" class="text">• Uvicorn ASGI server</text>
  <text x="120" y="670" class="text">• Port 8008</text>
  <text x="120" y="685" class="text">• CORS enabled</text>
  
  <rect x="320" y="615" width="180" height="80" class="component"/>
  <text x="410" y="635" text-anchor="middle" class="component-title">Search Endpoints</text>
  <text x="340" y="655" class="text">• POST /search (JSON)</text>
  <text x="340" y="670" class="text">• GET /search (params)</text>
  <text x="340" y="685" class="text">• Similarity threshold</text>
  
  <rect x="540" y="615" width="180" height="80" class="component"/>
  <text x="630" y="635" text-anchor="middle" class="component-title">Health &amp; Stats</text>
  <text x="560" y="655" class="text">• GET /health</text>
  <text x="560" y="670" class="text">• GET /stats</text>
  <text x="560" y="685" class="text">• Index metrics</text>
  
  <rect x="760" y="615" width="180" height="80" class="component"/>
  <text x="850" y="635" text-anchor="middle" class="component-title">Request Validation</text>
  <text x="780" y="655" class="text">• Pydantic models</text>
  <text x="780" y="670" class="text">• Input sanitization</text>
  <text x="780" y="685" class="text">• Error handling</text>
  
  <rect x="980" y="615" width="180" height="80" class="component"/>
  <text x="1070" y="635" text-anchor="middle" class="component-title">Response Format</text>
  <text x="1000" y="655" class="text">• JSON responses</text>
  <text x="1000" y="670" class="text">• Similarity scores</text>
  <text x="1000" y="685" class="text">• Case metadata</text>
  
  <!-- Integration Layer -->
  <rect x="50" y="740" width="1300" height="120" class="integration-layer" rx="8"/>
  <text x="70" y="765" class="layer-title">Integration Layer</text>
  
  <rect x="200" y="780" width="250" height="70" class="component"/>
  <text x="325" y="800" text-anchor="middle" class="component-title">Cognate AI System</text>
  <text x="220" y="820" class="text">• Replaces Coveo API2 integration</text>
  <text x="220" y="835" class="text">• Maintains existing user workflows</text>
  
  <rect x="500" y="780" width="200" height="70" class="component"/>
  <text x="600" y="800" text-anchor="middle" class="component-title">Load Balancer</text>
  <text x="520" y="820" class="text">• High availability</text>
  <text x="520" y="835" class="text">• Request distribution</text>
  
  <rect x="750" y="780" width="200" height="70" class="component"/>
  <text x="850" y="800" text-anchor="middle" class="component-title">Monitoring</text>
  <text x="770" y="820" class="text">• Performance metrics</text>
  <text x="770" y="835" class="text">• Health checks</text>
  
  <!-- Data Flow Arrows -->
  <line x1="300" y1="155" x2="350" y2="155" class="data-flow"/>
  <line x1="550" y1="155" x2="600" y2="155" class="data-flow"/>
  
  <line x1="200" y1="190" x2="200" y2="275" class="data-flow"/>
  <line x1="280" y1="315" x2="320" y2="315" class="data-flow"/>
  <line x1="500" y1="315" x2="540" y2="315" class="data-flow"/>
  <line x1="720" y1="315" x2="760" y2="315" class="data-flow"/>
  
  <line x1="410" y1="355" x2="410" y2="445" class="data-flow"/>
  <line x1="300" y1="485" x2="340" y2="485" class="data-flow"/>
  <line x1="540" y1="485" x2="580" y2="485" class="data-flow"/>
  
  <line x1="200" y1="525" x2="200" y2="615" class="api-flow"/>
  <line x1="280" y1="655" x2="320" y2="655" class="api-flow"/>
  <line x1="500" y1="655" x2="540" y2="655" class="api-flow"/>
  
  <line x1="410" y1="695" x2="410" y2="780" class="api-flow"/>
  
  <!-- Performance Metrics Box -->
  <rect x="1200" y="80" width="180" height="200" class="config-component" rx="6"/>
  <text x="1290" y="100" text-anchor="middle" class="component-title">Performance Targets</text>
  <text x="1220" y="125" class="small-text">Index Size: ~12GB</text>
  <text x="1220" y="145" class="small-text">Search Latency: &lt;100ms</text>
  <text x="1220" y="165" class="small-text">Throughput: 1K+ QPS</text>
  <text x="1220" y="185" class="small-text">Memory: 16GB RAM</text>
  <text x="1220" y="205" class="small-text">CPU: 8+ cores</text>
  <text x="1220" y="225" class="small-text">Accuracy: &gt;85% relevance</text>
  <text x="1220" y="245" class="small-text">Uptime: 99.9% SLA</text>
  <text x="1220" y="265" class="small-text">Scaling: Auto-scaling</text>
  
  <!-- Technology Stack -->
  <rect x="1200" y="300" width="180" height="180" class="config-component" rx="6"/>
  <text x="1290" y="320" text-anchor="middle" class="component-title">Tech Stack</text>
  <text x="1220" y="345" class="small-text">Python 3.11+</text>
  <text x="1220" y="365" class="small-text">FAISS 1.7.4</text>
  <text x="1220" y="385" class="small-text">FastAPI + Uvicorn</text>
  <text x="1220" y="405" class="small-text">SentenceTransformers</text>
  <text x="1220" y="425" class="small-text">UV Package Manager</text>
  <text x="1220" y="445" class="small-text">Pydantic Validation</text>
  <text x="1220" y="465" class="small-text">Loguru Logging</text>
  
  <!-- Deployment Info -->
  <rect x="1200" y="500" width="180" height="140" class="config-component" rx="6"/>
  <text x="1290" y="520" text-anchor="middle" class="component-title">Deployment</text>
  <text x="1220" y="545" class="small-text">Docker containers</text>
  <text x="1220" y="565" class="small-text">Kubernetes orchestration</text>
  <text x="1220" y="585" class="small-text">CI/CD with GitHub Actions</text>
  <text x="1220" y="605" class="small-text">Environment configs</text>
  <text x="1220" y="625" class="small-text">Health monitoring</text>
</svg>